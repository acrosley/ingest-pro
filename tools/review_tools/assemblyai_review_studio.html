<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AssemblyAI Review Studio</title>
    <link rel="stylesheet" href="assemblyai_review_studio.css">
</head>
<body>
    <div class="app-shell">
        <header class="app-header">
            <div class="brand">
                <h1>AssemblyAI Review Studio</h1>
                <span>Law Firm Intake QA</span>
            </div>
            <p class="mission">High-touch quality review that fuses AssemblyAI confidence scoring with venture-ready storytelling. Surface high-value details, calibrate confidence, and sync instantly with intake audio.</p>
            <div class="header-actions">
                <label class="file-input" id="reviewFileLabel">
                    <span>üìÑ Load Review</span>
                    <input type="file" id="reviewFile" accept=".json">
                </label>
                <label class="file-input" id="audioFileLabel">
                    <span>üéß Load Audio</span>
                    <input type="file" id="audioFile" accept="audio/*">
                </label>
                <button class="primary-btn" id="demoBtn">Launch Demo Call</button>
            </div>
        </header>

        <main class="main-layout">
            <section class="panel stats-panel" aria-label="Review metrics">
                <h2>Review Metrics</h2>
                <div class="stat-grid" id="statsGrid"></div>

                <div class="config-block" id="patternBlock">
                    <h3>Pattern Detection</h3>
                    <div class="config-row"><span>Phone Numbers</span><div class="toggle active" data-flag="phone"></div></div>
                    <div class="config-row"><span>Case Numbers</span><div class="toggle active" data-flag="case"></div></div>
                    <div class="config-row"><span>Money Amounts</span><div class="toggle active" data-flag="money"></div></div>
                    <div class="config-row"><span>Dates</span><div class="toggle active" data-flag="date"></div></div>
                    <div class="config-row"><span>Times</span><div class="toggle active" data-flag="time"></div></div>
                    <div class="config-row"><span>Names</span><div class="toggle active" data-flag="names"></div></div>
                    <div class="config-row"><span>Spelled Words</span><div class="toggle active" data-flag="spelled"></div></div>
                    <div class="config-row"><span>Numbers</span><div class="toggle active" data-flag="numbers"></div></div>
                </div>

                <div class="sidebar-actions">
                    <button class="ghost-btn" id="exportCorrectionsBtn">üíæ Export Corrections</button>
                    <p class="sidebar-hint">Transcript export and review snapshot controls now live inside the transcript toolbar for quicker access.</p>
                </div>
            </section>

            <section class="review-stage">
                <section class="audio-suite" aria-label="Audio intelligence">
                    <div class="audio-card">
                        <div class="audio-header">
                            <h2>Audio Sync Intelligence</h2>
                            <div class="audio-timestamps"><span id="currentTime">0:00</span><span>‚Ä¢</span><span id="duration">0:00</span><span id="confidenceScore">Confidence: --</span></div>
                        </div>
                        <div class="audio-player-wrapper">
                            <audio id="audioPlayer" controls preload="none"></audio>
                        </div>
                        <canvas id="waveformCanvas" class="waveform-canvas" aria-label="Waveform visualization"></canvas>
                    </div>
                </section>

                <section class="transcript-suite" aria-label="Transcript intelligence">
                    <div class="transcript-tabs" role="tablist">
                        <div class="tab-controls" role="presentation">
                            <button class="tab-btn active" id="linesTab" data-transcript-view="lines" role="tab" aria-selected="true" aria-controls="lineView">Line View</button>
                            <button class="tab-btn" id="wordsTab" data-transcript-view="words" role="tab" aria-selected="false" aria-controls="wordTrackerView">Word Tracker</button>
                        </div>
                        <button class="ghost-btn small layout-toggle" type="button" id="focusWordTrackerBtn" aria-pressed="false" aria-label="Toggle word tracker focus layout">
                            Word Tracker Focus
                        </button>
                    </div>

                    <div class="transcript-view is-active" id="lineView" role="tabpanel" aria-labelledby="linesTab">
                        <div class="transcript-toolbar transcript-toolbar--lines" role="region" aria-label="Transcript controls">
                            <div class="toolbar-group">
                                <label for="confidenceThreshold" class="toolbar-label">Highlight confidence below</label>
                                <input type="range" id="confidenceThreshold" min="0" max="1" step="0.05" value="0.7" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.7">
                                <span class="slider-value" id="thresholdValue">70%</span>
                            </div>
                            <div class="toolbar-group toolbar-group--actions">
                                <button class="ghost-btn small" id="editSpeakersBtn" type="button">üéôÔ∏è Edit Speakers</button>
                                <button class="ghost-btn small" id="exportTranscriptBtn" type="button">üìÑ Export Transcript</button>
                                <button class="primary-btn small" id="saveReviewBtn" type="button">üíæ Save Snapshot</button>
                            </div>
                        </div>
                        <div class="transcript-scroll">
                            <div class="transcript-lines" id="transcriptLineList">
                                <div class="empty-state">
                                    <h3>Load a review or launch the demo call to begin.</h3>
                                    <p>The full transcript will render here line by line for rapid scanning.</p>
                                </div>
                            </div>
                        </div>
                        <div class="transcript-status" role="status" aria-live="polite">
                            <span id="lineTotalWords">Words: 0</span>
                            <span id="lineLowConfidence">Low Confidence: 0</span>
                            <span id="lineFlaggedWords">Flags: 0</span>
                            <span id="lineCurrentWord">Current: --</span>
                        </div>
                    </div>

                    <div class="transcript-view" id="wordTrackerView" role="tabpanel" aria-labelledby="wordsTab">
                        <div class="transcript-toolbar">
                            <div class="filter">
                                <label for="filterPriority">Priority</label>
                                <select id="filterPriority">
                                    <option value="all">All</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div class="filter">
                                <label for="filterType">Flag Type</label>
                                <select id="filterType">
                                    <option value="all">All Types</option>
                                </select>
                            </div>
                            <label><input type="checkbox" id="showOnlyFlagged" checked> Show Only Flagged</label>
                            <label><input type="checkbox" id="enableGreenHighlight" checked> Enable Success Highlight</label>
                            <input type="search" id="searchInput" placeholder="Search transcript‚Ä¶" class="filter">
                        </div>
                        <div class="transcript-content" id="wordList">
                            <div class="empty-state">
                                <h3>Load a review or launch the demo call to begin.</h3>
                                <p>Flagged content, context, and audio sync will populate instantly.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <div class="right-rail">
                <section class="panel corrector-panel" aria-label="Word corrector">
                    <h2>Word Corrector</h2>
                    <p class="mission">Select any word to review context, apply corrections, and keep the intake story accurate.</p>
                    <div class="corrector-body">
                        <div class="corrector-selected" id="correctorSelected">Pick a word from the transcript to begin.</div>
                        <div class="corrector-context" id="correctorContext"></div>
                        <div class="corrector-flags" id="correctorFlags"></div>
                        <form id="correctorForm" class="corrector-form">
                            <label for="correctorInput">Replacement</label>
                            <input type="text" id="correctorInput" placeholder="Type the corrected word or phrase‚Ä¶" disabled>
                            <div class="corrector-actions">
                                <button type="submit" class="primary-btn small" id="saveCorrectionBtn" disabled>Save Correction</button>
                                <button type="button" class="ghost-btn small" id="clearCorrectionBtn" disabled>Remove Correction</button>
                            </div>
                        </form>
                    </div>
                </section>

                <section class="panel dictionary-panel" aria-label="Dictionary queue">
                    <h2>Dictionary Queue</h2>
                    <p class="mission">Capture names and key terms for continuous model improvement. Export directly into your playbook.</p>
                    <div class="dictionary-list" id="dictionaryList"></div>
                    <button class="ghost-btn" id="exportDictionaryBtn">üìñ Export Dictionary (<span id="dictCount">0</span>)</button>
                </section>
            </div>
        </main>
    </div>

    <div class="toast" id="toast"></div>

    <script type="module" src="assemblyai_review_studio.js"></script>
</body>
</html>
